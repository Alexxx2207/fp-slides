\documentclass{beamer}
\usepackage{fp}

\title[Среди и процеси]{Модел на средите и изчислителни процеси}

\date{21 октомври 2015 г.}

\begin{document}

\begin{frame}
  \titlepage
\end{frame}

\section{Модел на средите}

\begin{frame}
  \frametitle{Среди в Scheme}

  \begin{itemize}[<+->]
  \item Връзката между символите и техните оценки се записват в речник, който се нарича \textbf{среда}.
  \item Всеки символ има най-много една оценка в дадена среда.
  \item В даден момент могат да съществуват много среди.
  \item Символите винаги се оценяват в една конкретна среда.
  \item \alert{Символите могат да има различни оценки в различни среди.}
  \item При стартиране Scheme по подразбиране работи в \textbf{глобалната среда}.
  \item В глобалната среда са дефинирани символи за стандартни операции и функции.
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Пример за среда}

  \begin{columns}[t,onlytextwidth]
    \column{0.5\textwidth}
    {}

    \begin{itemize}[<+->]
    \item \evalstoerr r
    \item \tt{(define r 5)}
    \item \evalsto{(+ r 3)}8
    \item \tt{(define (sq x) (* x x))}
    \item \evalsto{(sq 3)}9
    \item \evalsto{(sq r)}{25}
    \end{itemize}

    \column{0.5\textwidth}
    {}

    \begin{env}{E}
      \only<2->{
        \\\firstinenv\tt r&:&\tt 5
      }
      \only<4->{
        \\\tt{sq}&:&\funcenv x{(* x x)}E
      }
    \end{env}
  \end{columns}
\end{frame}

\begin{frame}
  \frametitle{Функции и среди}

  \begin{itemize}[<+->]
  \item Всяка функция \tt f пази указател към средата \textbf E, в която е дефинирана.
  \item При извикване на \tt f:
    \begin{itemize}
    \item създава се нова среда \textbf{E$_1$}, която разширява \textbf{E}
    \item в \textbf{E$_1$} всеки символ означаващ формален параметър се свързва с оценката на фактическия параметър
    \item тялото на $f$ се изпълнява в \textbf{E$_1$}
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Дърво от среди}
  \begin{itemize}[<+->]
  \item Всяка среда пази указател към своя ``родителска среда'', която разширява
  \item така се получава дърво от среди
  \item при оценка на символ в дадена среда \textbf E
    \begin{itemize}
    \item първо се търси оценката му в \textbf E
    \item ако символът не е дефиниран в \textbf E, се преминава към родителската среда
    \item при достигане на най-горната среда, ако символът не е дефиниран и в нея се извежда съобщение за грешка
    \end{itemize}
  \end{itemize}
\end{frame}

\begin{frame}
  \frametitle{Извикване на дефинирана функция}

  \begin{columns}[t,onlytextwidth]
    \column{0.5\textwidth}
    {}

    \begin{itemize}[<+->]
    \item \tt{(define r 5)}
    \item \tt{(define (sq x) (* x x))}
    \item \begin{tabular}[t]{lc}
            \inenv E&\tt{(sq r)}\\
            \nxt{&\bda\\
            \inenv E &\tt{(sq 5)}\\
            \nxt{&\bda\\
            \inenv {E$_1$} &\tt{(* x x)}\\
            \nxt{&\bda\\
            &\tt{25}}}}
          \end{tabular}
        \end{itemize}

    \column{0.5\textwidth}
    {}

    \begin{tabular}{c}
      \begin{env}{E}
        \\\firstinenv\tt r&:&\tt 5
        \only<2->{\\\tt{sq}&:&\funcenv x{(* x x)}E}
      \end{env}
      \\
      \only<5->{
      \Bigg\uparrow\\
      \begin{env}{E$_1$}
        \\\firstinenv\tt x&:&5
      \end{env}}
    \end{tabular}
  \end{columns} 
\end{frame}

\section{Рекурсия}

\begin{frame}
  \frametitle{Какво е рекурсия?}

  \pause
  Повторение чрез позоваване на себе си
  \vspace{1em}
  
  \pause
  Рекурсивна функция: дефинира се чрез себе си

  \begin{equation*}
    n! =
    \begin{cases}
      1,&\text{ при }n = 0,\\
      n\cdot (n-1)!,&\text{ при }n > 0.
    \end{cases}
  \end{equation*}
  \vspace{1em}

  \pause
  По-точно: решение на рекурсивно уравнение
  \begin{equation*}
    \onslide<5->{\Gamma(f)(n) :=} f(n) =
    \begin{cases}
      1,&\text{ при }n = 0,\\
      n \cdot f(n-1),&\text{ при }n > 0.
    \end{cases}.
  \end{equation*}

  \pause
  \alert{$n!$ е ``най-малкото'' решение на горното уравнение $\Gamma(f) = f$.}
\end{frame}


\begin{frame}[fragile]
  \frametitle{Най-малка неподвижна точка}

  \begin{theorem}[Knaster-Tarski]
    Ако $\Gamma$ е изчислим оператор, то уравнението $f = \Gamma(f)$ има единствено най-малко решение \pause (\textbf{най-малка неподвижна точка на $\Gamma$}). \pause Нещо повече, решението точно съответства на рекурсивна програма пресмятаща $f$ чрез $\Gamma$.
  \end{theorem}

  \pause

\begin{verbatim}
(define (fact n)
  (if (= n 0) 1
      (* n (fact (- n 1)))))
\end{verbatim}

  \pause

  Кое е \textbf{най-малкото решение} на уравнението $f(x) = 1 + f(x-1)$?

  \pause

\verb#(define (f x) (+ 1 (f (- x 1)))#\\
\evalsto{(f 0)}?

  \pause

  $f$ е ``празната функция'', т.е. $\mathrm{dom}(f) = \emptyset$.
  
\end{frame}

\begin{frame}
  \frametitle{Оценка на рекурсивна функция}

  \begin{center}
    \footnotesize
    \begin{tabular}{c}
      \tt{(fact 4)}\\
      \pause
      \nxt{\bda\\
      \alt<+->{\tt{(* 4 (fact 3))}}{\tt{(if (= 4 0) 1 (* 4 (fact (- 4 1))))}}\\
      \nxt{\bda\\
      \alt<+->{\tt{(* 4 (* 3 (fact 2)))}}{\tt{(* 4 (if (= 3 0) 1 (* 3 (fact (- 3 1)))))}}\\
      \nxt{\bda\\
      \alt<+->{\tt{(* 4 (* 3 (* 2 (fact 1))))}}{\tt{(* 4 (* 3 (if (= 2 0) 1 (* 2 (fact (- 2 1))))))}}\\
      \nxt{\bda\\
      \alt<+->{\tt{(* 4 (* 3 (* 2 (* 1 (fact 0)))))}}{\tt{(* 4 (* 3 (* 2 (if (= 1 0) 1 (* 1 (fact (- 1 1)))))))}}\\
      \nxt{\bda\\
      \tt{(* 4 (* 3 (* 2 (* 1 1))))}\\
      \nxt{\bda\\
      \tt{(* 4 (* 3 (* 2 1)))}\\
      \nxt{\bda\\
      \tt{(* 4 (* 3 2))}\\
      \nxt{\bda\\
      \tt{(* 4 6)}\\
      \nxt{\bda\\
      24}}}}}}}}}
    \end{tabular}
  \end{center}
\end{frame}

\end{document}
